<!DOCTYPE html>
<head>
    <title>EuroTurismVis</title>
    <div>
        <span id="year">YEAR</span>
        <span id="ArrDep1">Arrivals</span>
        <span id="ArrDep2">Departures</span>
        <span id="Authors">This project was made by Javier Antuna Gonzalez and Maria Ramirez Mateo.</span>
        <span id="linkGithub">Click here to access <a href="https://github.com/javierantuna/EuroTurismVis">the GitHub repository</a>.</span>
        <input type="range" id="rangeInput" name="rangeInput" min="1995" max="2015" value="1995" onchange="updateTextInput(this.value);">
        <input type="text" id="textInput" value="1995">
        <span id="title" class="text-center" style="font-size: 35px; font-weight: bold; color: blue; align: center;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tourism In Europe</span>
    </div>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
<div id="option">
    <input name="updateButton"
           id="buttonReturn"
           type="button"
           value="Return"
           onclick="comeback()" />
    <input name="changeButton"
           id="buttonChange"
           type="button"
           value="Change to Departures"
           onclick="changeView()" />
    <input name="graphicsButton"
           id="buttonGraph"
           type="button"
           value="Change to Evolution by years"
           onclick="changeGraph()" />
</div>

<script>
    document.getElementById("buttonReturn").style.visibility = "hidden";
    document.getElementById("buttonChange").style.visibility = "hidden";
	
	var textArrDep1 = document.getElementById('ArrDep1')
    textArrDep1.style.position = "absolute";
    textArrDep1.style.left = "100px";
    textArrDep1.style.top = "30px";
	
	var textArrDep2 = document.getElementById('ArrDep2')
    textArrDep2.style.position = "absolute";
    textArrDep2.style.left = "100px";
    textArrDep2.style.top = "30px";
	
	var textAuthors = document.getElementById('Authors')
    textAuthors.style.position = "absolute";
    textAuthors.style.left = "400px";
    textAuthors.style.top = "720px";
	
	var textGithub = document.getElementById('linkGithub')
    textGithub.style.position = "absolute";
    textGithub.style.left = "400px";
    textGithub.style.top = "740px";
	
	d3.select('#ArrDep1')
		.style("font-size", "24px")
        .style("text-decoration", "underline")
        .style("font-weight", "bold")
        .style("visibility", "hidden");
	
	d3.select('#ArrDep2')
		.style("font-size", "24px")
        .style("text-decoration", "underline")
        .style("font-weight", "bold")
        .style("visibility", "hidden");
	
	d3.select('#Authors')
		//.style("font-size", "24px")
        //.style("text-decoration", "underline")
        //.style("font-weight", "bold")
        //.style("visibility", "hidden");
	
	d3.select('#linkGithub')
		//.style("font-size", "24px")
        //.style("text-decoration", "underline")
        //.style("font-weight", "bold")
        //.style("visibility", "hidden");
		
	d3.select("body").append("a")
    .attr("xlink:href", "http://en.wikipedia.org/wiki/")
    .append("rect")
    .attr("x", 400)
    .attr("y", 800)
    .attr("height", 100)
    .attr("width", 200)
    .style("fill", "lightgreen")
    .attr("rx", 10)
    .attr("ry", 10);
	
    var simulation,
        leerPais,
        columnForColors = "year",
        columnForTitle = "country";
    function updateTextInput(val) { //Para mostrar el año en el slider
        document.getElementById('textInput').value=val;}
    function GraphByYear() {
        var width=650,
            height = 700
            border=1,
            bordercolor='black';
        var svg1 = d3.select("body").append("svg")
            .attr("width",  width  )
            .attr("height", height)
            .attr("id", "chart1")
            .append("g")
            .attr("border",border)
            .style("display", "inline-block");
        var svg2 = d3.select("body").append("svg")
            .attr("width",  width)
            .attr("height", height)
            .attr("id", "chart2")
            .append("g")
            .attr("border",border)
            .style("display", "inline-block");
		d3.select('#year').style("visibility", "visible");
		d3.select('#textInput').style("visibility", "visible");
		d3.select('#rangeInput').style("visibility", "visible");
		d3.select('#buttonReturn').style("visibility", "hidden");
        d3.csv('data/arrivals-departures.csv', function(error, data) {
            if (error) {console.error('Error getting or parsing the data.');
                throw error;}
            d3.select("#rangeInput").on("change", function() {
                simulation.alpha(1).restart();
                bubbleChart().width(650).height(700);
                bubbleChart2().width(650).height(700);
                d3.select('#chart1').data(data).call(chart);
                d3.select('#chart2').data(data).call(chart2);
            });
            var chart = bubbleChart().width(650).height(700);
            var chart2 = bubbleChart2().width(650).height(700);
            d3.select('#chart1').data(data).call(chart);
            d3.select('#chart2').data(data).call(chart2);
        });
    }
    function bubbleChart() {
        var columnForRadius1 = "arrivals";
        function chart(selection) {
            var data = selection.enter().data();
            d3.select('#chart1').append("text") //Titulo del grafico
                .attr("x", (width / 2))
                .attr("y", 50)
                .attr("text-anchor", "middle")
                .style("font-size", "20px")
                .style("text-decoration", "underline")
                .style("font-weight", "bold")
                .text("Arrivals");
            var tooltip = d3.select("body")  //Texto al pasar sobre la burbuja
                .append("div")
                .style("position", "absolute")
                .style("visibility", "hidden")
                .style("color", "DarkBlue")
                .style("padding", "8px")
                .style("background-color", "CornflowerBlue")
                .style("border-radius", "15px")
                .style("text-align", "center")
                .style("font-family", "monospace")
                .style("width", "140px")
                .text("");
            simulation = d3.forceSimulation(data.filter(function(d){ return d.year==+document.getElementById('textInput').value; }))
                .force("charge", d3.forceManyBody().strength([-50]))
                .force("x", d3.forceX())
                .force("y", d3.forceY())
                .on("tick", ticked);
            function ticked(e) {   //Define el tamaño de cada circulo
                d3.select('#chart1').selectAll("circle").attr("cx", function (d) {return 2 * d.x;})
                    .attr("cy", function (d) {return 2 * d.y;});
            }
            var colorCircles1 = d3.scaleLinear()
                .range(["pink", "red"])
                .domain([0, 20000000]);
            var scaleRadius = d3.scaleLinear().domain([d3.min(data, function (d) {
                return +d[columnForRadius1];
            }), d3.max(data, function (d) {
                return +d[columnForRadius1];
            })]).range([5, 60]);
            d3.select('#chart1').append("rect") //Recuadro del gráfico
                .attr("x", 0)
                .attr("y", 10)
                .attr("height", height-60)
                .attr("width", width)
                .style("stroke", bordercolor)
                .style("fill", "none")
                .style("stroke-width", border);
            d3.select('#chart1').selectAll("circle")
                .data(data.filter(function(d){return d.year==+document.getElementById('textInput').value;}))
                .enter()
                .append("circle")
                .attr('r', function (d) {return scaleRadius(d[columnForRadius1])})
                .style("fill", function (d) {return colorCircles1(d[columnForRadius1])})
                .attr('transform', 'translate(' + [width / 2, height / 2] + ')')
                .on("mouseover", function (d) {
                    tooltip.html(d[columnForColors] + "<br>" + d[columnForTitle] + "<br>" + d[columnForRadius1] + " people");
                    return tooltip.style("visibility", "visible");
                })
                .on("mousemove", function () {return tooltip.style("top", (d3.event.pageY - 10) + "px").style("left", (d3.event.pageX + 10) + "px");})
                .on("mouseout", function () {return tooltip.style("visibility", "hidden");})
                .on ("click", function(d){
                    leerPais = d[columnForTitle];
                    d3.select("#chart1").remove();
                    d3.select("#chart2").remove();
                    tooltip.style("visibility", "hidden");
                    d3.select("#year").style("visibility", "hidden");
                    d3.select("#rangeInput").style("visibility", "hidden");
                    d3.select("#textInput").style("visibility", "hidden");
                    document.getElementById("buttonReturn").style.visibility = "visible";
					textAuthors.style.top = "620px";
					textGithub.style.top = "640px";
                    piechart();
                });
            d3.select('#chart1').selectAll("circle")
                .data(data.filter(function(d){return d.year==+document.getElementById('textInput').value;}))
                .attr('r', function (d) {return scaleRadius(d[columnForRadius1])})
                .style("fill", function (d) {return colorCircles1(d[columnForRadius1])})
        }
        chart.width = function (value) {
            if (!arguments.length) {return width;}
            width = value;
            return chart;
        };
        chart.height = function (value) {
            if (!arguments.length) {return height;}
            height = value;
            return chart;
        };
        chart.columnForColors = function (value) {
            if (!arguments.columnForColors) {return columnForColors;}
            columnForColors = value;
            return chart;
        };
        chart.columnForRadius1 = function (value) {
            if (!arguments.columnForRadius1) {return columnForRadius1;}
            columnForRadius1 = value;
            return chart;
        };
        return chart;
    }
    function bubbleChart2() {
        var columnForRadius2 = "departures";
        function chart2(selection) {
            var data = selection.enter().data();
            // var div = selection;
            d3.select('#chart2').append("text")  //Titulo del grafico
                .attr("x", (width / 2))
                .attr("y", 50)
                .attr("text-anchor", "middle")
                .style("font-size", "20px")
                .style("text-decoration", "underline")
                .style("font-weight", "bold")
                .text("Departures");
            var tooltip = d3.select("body")  //Texto al pasar sobre la burbuja
                .append("div")
                .style("position", "absolute")
                .style("visibility", "hidden")
                .style("color", "DarkBlue")
                .style("padding", "8px")
                .style("background-color", "CornflowerBlue")
                .style("border-radius", "15px")
                .style("text-align", "center")
                .style("font-family", "monospace")
                .style("width", "140px")
                .text("");
            simulation = d3.forceSimulation(data.filter(function(d){return d.year==+document.getElementById('textInput').value;}))
            // .force("charge", d3.forceManyBody().strength([-50]))
            // .force("x", d3.forceX())
            // .force("y", d3.forceY())
                .on("tick", ticked2);
            function ticked2(e) {   //Define el tamaño de cada circulo
                d3.select('#chart2').selectAll("circle").attr("cx", function(d) {
                    return 2*d.x;
                })
                    .attr("cy", function(d) {
                        return 2*d.y;
                    });
            }
            var colorCircles2 = d3.scaleLinear()
                .range(["LightGreen","ForestGreen"])
                .domain([0, 20000000]);
            var scaleRadius = d3.scaleLinear().domain([d3.min(data, function(d) {
                return +d[columnForRadius2];
            }), d3.max(data, function(d) {
                return +d[columnForRadius2];
            })]).range([5, 60]);
            d3.select('#chart2').append("rect") //Recuadro del gráfico
                .attr("x", 0)
                .attr("y", 10)
                .attr("height", height-60)
                .attr("width", width)
                .style("stroke", bordercolor)
                .style("fill", "none")
                .style("stroke-width", border);
            d3.select('#chart2').selectAll("circle")
                .data(data.filter(function(d){return d.year==+document.getElementById('textInput').value;}))
                .enter()
                .append("circle")
                .attr('r', function(d) {return scaleRadius(d[columnForRadius2])})
                .style("fill", function(d) {return colorCircles2(d[columnForRadius2])})
                .attr('transform', 'translate(' + [width / 2, height / 2] + ')')
                .on("mouseover", function(d) {
                    tooltip.html(d[columnForColors] + "<br>" + d[columnForTitle] + "<br>" + d[columnForRadius2] + " people");
                    return tooltip.style("visibility", "visible");
                })
                .on("mousemove", function() {return tooltip.style("top", (d3.event.pageY - 10) + "px").style("left", (d3.event.pageX + 10) + "px");})
                .on("mouseout", function() {return tooltip.style("visibility", "hidden");})
                .on ("click", function(d){
                    leerPais = d[columnForTitle];
                    d3.select("#chart1").remove();
                    d3.select("#chart2").remove();
                    tooltip.style("visibility", "hidden");
                    d3.select("#year").style("visibility", "hidden");
                    d3.select("#rangeInput").style("visibility", "hidden");
                    d3.select("#textInput").style("visibility", "hidden");
                    document.getElementById("buttonReturn").style.visibility = "visible";
					textAuthors.style.top = "620px";
					textGithub.style.top = "640px";
                    piechart();
                });
            d3.select('#chart2').selectAll("circle")
                .data(data.filter(function(d){return d.year==+document.getElementById('textInput').value;}))
                .attr('r', function (d) {return scaleRadius(d[columnForRadius2])})
                .style("fill", function (d) {return colorCircles2(d[columnForRadius2])})
        }
        chart2.width = function(value) {
            if (!arguments.length) {return width;}
            width = value;
            return chart2;
        };
        chart2.height = function(value) {
            if (!arguments.length) {return height;}
            height = value;
            return chart2;
        };
        chart2.columnForColors = function(value) {
            if (!arguments.columnForColors) {return columnForColors;}
            columnForColors = value;
            return chart2;
        };
        chart2.columnForRadius2 = function(value) {
            if (!arguments.columnForRadius2) {return columnForRadius2;}
            columnForRadius2 = value;
            return chart2;
        };
        return chart2;
    }
    function piechart(){
        var width2=960,
            height2 = 550;
        var svg3 = d3.select("body").append("svg")
            .attr("width",  width2)
            .attr("height", height2)
            .attr("id", "pie")
            .append("g");
        var radius = ((Math.min(width2, height2) / 2)-30),
            g = d3.select('#pie').append("g").attr("transform", "translate(" + ((width2 / 2)+200) + "," + ((height2/2)+15) + ")");
        svg3.append("text") //Titulo del grafico
            .attr("x", ((width2 / 2)+200))
            .attr("y",  30)
            .attr("text-anchor", "middle")
            .style("font-size", "20px")
            .style("text-decoration", "underline")
            .style("font-weight", "bold")
            .text("Arrivals to " + leerPais + " in 2014");
        svg3.append("text") //Titulo del grafico
            .attr("x", ((width2 / 2)+200))
            .attr("y",  535)
            .attr("text-anchor", "middle")
            .style("font-size", "20px")
            .style("text-decoration", "underline")
            .style("font-weight", "bold")
            .text("Departures from " + leerPais + " in 2014");
        var color = d3.scaleOrdinal(["#DC143C", "#8B0000", "#E9967A", "#FF1493", "#B22222", "#CD5C5C", "#FFE4E1","#FFC0CB", "#FF0000"]);
        var color2 = d3.scaleOrdinal(["#7FFF00", "#006400", "#556B2F", "#8FBC8F", "#228B22", "#008000", "#ADFF2F","#90EE90", "#00FF00", "#32CD32", "#3CB371", "#808000", "#6B8E23", "#98FB98"]);
        var pie = d3.pie()
            .sort(null)
            .value(function(d) { return d[leerPais]; })
            .startAngle(-90 * (Math.PI/180))
            .endAngle(90 * (Math.PI/180));
        var pie2 = d3.pie()
            .sort(null)
            .value(function(d) { return d[leerPais]; })
            .startAngle(90 * (Math.PI/180))
            .endAngle(270 * (Math.PI/180));
        var arcOver = d3.arc()
            .outerRadius(radius +10)
            .innerRadius(0);
        var path = d3.arc()
            .outerRadius(radius - 10)
            .innerRadius(0);
        var path2 = d3.arc()
            .outerRadius(radius - 30)
            .innerRadius(0);
        var tooltip = d3.select("body")
            .append("div")
            .style("position", "absolute")
            .style("visibility", "hidden")
            .style("color", "DarkBlue")
            .style("padding", "8px")
            .style("background-color", "CornflowerBlue")
            .style("border-radius", "15px")
            .style("text-align", "center")
            .style("font-family", "monospace")
            .style("width", "140px")
            .text("");
        d3.csv("data/intOrig.csv", function(d) {
            return d;
        }, function(error, data) {
            if (error) throw error;
            var arc = g.selectAll(".arc")
                .data(pie(data.filter(function(d){return d[leerPais];})))
                .enter().append("g")
                .attr("class", "arc");
            arc.append("path")
                .attr("d", path)
                .attr("fill", function(d) { return color(d.data.CountryName); })
                .on("mouseover", function(d){
                    var total = d3.sum(data, function(d) {return parseFloat(d[leerPais]);});
                    var percent = Math.round(1000 * parseFloat(d.data[leerPais]) / total) / 10;
                    tooltip.html(d.data.CountryName + "<br>" + d.data[leerPais] + " people" + "<br>" + percent + "%");
                    d3.select(this).attr("d", arcOver);
                    return tooltip.style("visibility", "visible");
                })
                .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
                .on("mouseout", function(){
                    d3.select(this).attr("d", path);
                    percent="";
                    total="";
                    return tooltip.style("visibility", "hidden");});
        });
        d3.csv("data/intDest.csv", function(d) {
            return d;
        }, function(error, data) {
            if (error) throw error;
            var arc2 = g.selectAll(".arc2")
                .data(pie2(data.filter(function(d){return d[leerPais];})))
                .enter().append("g")
                .attr("class", "arc2");
            arc2.append("path")
                .attr("d", path2)
                .attr("fill", function(d) { return color2(d.data.CountryName); })
                .on("mouseover", function(d){
                    var total = d3.sum(data, function(d) {return parseFloat(d[leerPais]);});
                    var percent = Math.round(1000 * parseFloat(d.data[leerPais]) / total) / 10;
                    tooltip.html(d.data.CountryName + "<br>" + d.data[leerPais] + " people" + "<br>" + percent + "%");
                    d3.select(this).attr("d", arcOver);
                    return tooltip.style("visibility", "visible");})
                .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
                .on("mouseout", function(){
                    d3.select(this).attr("d", path2);
                    percent="";
                    total="";
                    return tooltip.style("visibility", "hidden");});
        });
    }
    function comeback(){
        d3.select("#pie").remove();
		textAuthors.style.top = "720px";
		textGithub.style.top = "740px";
        GraphByYear();
    }
    GraphByYear();
    ////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////
    var margin_j = {top_j: 20, right_j: 55, bottom_j: 30, left_j: 40},
        width_j  = 1350 - margin_j.left_j - margin_j.right_j,
        height_j = 580  - margin_j.top_j  - margin_j.bottom_j;
    var x_j = d3.scaleBand()
        .rangeRound([0, width_j - 300])
        .padding(0.1);
    var y_j = d3.scaleLinear()
        .range([height_j, 0]);
    var xAxis_j = d3.axisBottom(x_j);
    var yAxis_j = d3.axisLeft(y_j);
    var line_j = d3.line()
        .x(function (d) { return x_j(d.label) + x_j.bandwidth() / 2; })
        .y(function (d) { return y_j(d.value); });
    var color_j = d3.scaleOrdinal(d3.schemeCategory20);
    var tooltip_j = d3.select("body")
        .append("div")
        .style("position", "absolute")
        .style("opacity", 0)
        .style("color", "black")
        .style("padding", "8px")
        .style("background-color", "lightsteelblue")
        .style("border-radius", "15px")
        .style("text-align", "center")
        .style("font-family", "sans-serif")
        .style("width", "140px")
        .attr("x", 140)
        .text("");
    var button1 = document.getElementById('buttonReturn')
    button1.style.position = "absolute";
    button1.style.left = "70px";
    button1.style.top = "20px";
    var button2 = document.getElementById('buttonChange')
    button2.style.position = "absolute";
    button2.style.left = (width_j-70) + 'px';
    button2.style.top = "150px";
    var button3 = document.getElementById('buttonGraph')
    button3.style.position = "absolute";
    button3.style.left = (width_j-150) + 'px';
    button3.style.top = "20px";
    var showArriv = "1";
    var showEvolution = "0";
    function GraphTimeArriv() {
        d3.select("#svg_j_1").remove();
        d3.select("#svg_j_2").remove();
        svg_j_1 = d3.select("body").append("svg")
            .attr("width",  width_j  + margin_j.left_j + margin_j.right_j)
            .attr("height", height_j + margin_j.top_j  + margin_j.bottom_j)
            .attr("id", "svg_j_1")
            .append("g")
            .attr("transform", "translate(" + margin_j.left_j + "," + margin_j.top_j + ")");
        d3.csv("data/arrivals.csv", function (error, data) {
            var labelVar_j_1 = 'year';
            var varNames_j_1 = d3.keys(data[0])
                .filter(function (key) { return key !== labelVar_j_1;});
            color_j.domain(varNames_j_1);
            var seriesData_j_1 = varNames_j_1.map(function (name) {
                return {
                    name: name,
                    values: data.map(function (d) {
                        return {name: name, label: d[labelVar_j_1], value: (+d[name])/1000};
                    })
                };
            });
            x_j.domain(data.map(function (d) { return d.year; }));
            y_j.domain([0,0]);
            svg_j_1.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height_j + ")")
                .call(xAxis_j);
            svg_j_1.append("g")
                .attr("class", "y axis")
                .call(yAxis_j)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "0.71em")
                .attr("fill", "#000")
                .text("Number of people (in thousands)");
            var legend_j_1 = svg_j_1.selectAll(".legend")
                .data(color_j.domain())
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) { return "translate(0," + i * 13.5 + ")"; });
            var series_j_1 = svg_j_1.selectAll(".series")
                .data(seriesData_j_1)
                .enter().append("g")
                .attr("class", "series");
            series_j_1.append("path")
                .attr("class", "line")
                .attr("d", function (d) { return line_j(d.values); })
                .style("stroke", function (d) { return color_j(d.name); })
                .style("stroke-width", "4px")
                .style("fill", "none")
                .style("opacity", 0)
                .on("mouseover", function(d) {
                    if(d3.select(this).style('opacity') == 1) {
                        tooltip_j.transition()
                            .duration(100)
                            .style("opacity", 0.9);
                        tooltip_j.html(d.name/* + " ("  + data.year + ")<br/>"  + data.value + " people"*/)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                    }
                });
            var	maximum_j_1 = 0;
            legend_j_1.append("circle")
                .style("fill", function(d) { return color_j(d); })
                .attr("r", 5)
                .attr("transform", function(d, i) {
                    return "translate(" + (width_j -260) + "," + -10 + ")";
                })
                .on("mouseover", function(d) {
                    d3.select(this).attr("r", 10);
                })
                .on("mouseout", function(d) {
                    d3.select(this).attr("r", 5);
                })
                .on("click", function(d) {
                    d3.selectAll(".line")
                        .filter(function(e) {
                            return e.name == d;
                        })
                        .style("opacity", function() {
                            if(d3.select(this).style('opacity') == 1) {
                                d3.selectAll('text[d="'+d+'"]')
                                    .style("font-weight", "")
                                    .style("fill", "grey");
                                return 0;
                            }
                            else {
                                d3.selectAll('text[d="'+d+'"]')
                                    .style("font-weight", "bold")
                                    .style("fill", "black");
                                return 1;
                            }
                        });
                    var maximum_j_1 = d3.max(seriesData_j_1, function(e) {
                        return d3.max(e.values, function (c) {
                            if ((d3.selectAll(".line")
                                    .filter(function(f) {
                                        return c.name == f.name;
                                    })
                                    .style('opacity')) == 1) { return c.value; }
                            else { return 0; }
                        });
                    });
                    y_j.domain([0, maximum_j_1]);
                    svg_j_1.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(yAxis_j);
                    svg_j_1.selectAll(".line")
                        .transition()
                        .duration(1000)
                        .attr("d", function(d) { return line_j(d.values); });
                    tooltip_j.transition().style("opacity", 0);
                })
            legend_j_1.append("text")
                .attr("x", width_j-250)
                .attr("y", -10)
                .attr("dy", ".25em")
                .attr("d", function(d) { return d; })
                .style("text-anchor", "start")
                .style("font-weight", "")
                .style("fill", "grey")
                .text(function(d) { return d; })
            svg_j_1.append("circle")
                .style("fill", "black")
                .attr("cx", width_j-110)
                .attr("cy", -10)
                .attr("r", 5)
                .on("mouseover", function(d) {
                    d3.select(this).attr("r", 10);
                })
                .on("mouseout", function(d) {
                    d3.select(this).attr("r", 5);
                })
                .on("click", function(d) {
                    d3.selectAll(".line").style("opacity", 1);
                    maximum_j = d3.max(seriesData_j_1, function (c) {
                        return d3.max(c.values, function (d) { return d.value; });
                    })
                    y_j.domain([
                        d3.min(seriesData_j_1, function (c) {
                            return d3.min(c.values, function (d) { return d.value; });
                        }), maximum_j ]);
                    svg_j_1.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(yAxis_j);
                    svg_j_1.selectAll(".line")
                        .transition()
                        .duration(1000)
                        .attr("d", function (d) { return line_j(d.values); });
                    tooltip_j.transition().style("opacity", 0);
                    legend_j_1.selectAll("text")
                        .style("font-weight", "bold")
                        .style("fill", "black");
                });
            svg_j_1.append("text")
                .attr("x", width_j-100)
                .attr("y", -10)
                .attr("dy", ".25em")
                .style("text-anchor", "start")
                .text("Show all countries");
            svg_j_1.append("circle")
                .style("fill", "white")
                .attr("cx", width_j-110)
                .attr("cy", 10)
                .attr("r", 5)
                .style("stroke", "black")
                .style("stroke-width", "1px")
                .on("mouseover", function(d) {
                    d3.select(this).attr("r", 10);
                })
                .on("mouseout", function(d) {
                    d3.select(this).attr("r", 5);
                })
                .on("click", function(d) {
                    d3.selectAll(".line").style("opacity", 0);
                    maximum_j = 0;
                    y_j.domain([0, 0]);
                    svg_j_1.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(yAxis_j);
                    svg_j_1.selectAll(".line")
                        .transition()
                        .duration(1000)
                        .attr("d", function (d) { return line_j(d.values); });
                    tooltip_j.transition().style("opacity", 0);
                    legend_j_1.selectAll("text")
                        .style("font-weight", "")
                        .style("fill", "grey");
                });
            svg_j_1.append("text")
                .attr("x", width_j-100)
                .attr("y", 10)
                .attr("dy", ".25em")
                .style("text-anchor", "start")
                .text("Hide all countries");
        });
    }
    /////////////////////////////////////////////////////////////////////////////////////////////////////
    function GraphTimeDepar() {
        d3.select("#svg_j_1").remove();
        var svg_j_2 = d3.select("body").append("svg")
            .attr("width",  width_j  + margin_j.left_j + margin_j.right_j)
            .attr("height", height_j + margin_j.top_j  + margin_j.bottom_j)
            .attr("id", "svg_j_2")
            .append("g")
            .attr("transform", "translate(" + margin_j.left_j + "," + margin_j.top_j + ")");
        d3.csv("data/departures.csv", function (error, data) {
            var labelVar_j_2 = 'year';
            var varNames_j_2 = d3.keys(data[0])
                .filter(function (key) { return key !== labelVar_j_2;});
            color_j.domain(varNames_j_2);
            var seriesData_j_2 = varNames_j_2.map(function (name) {
                return {
                    name: name,
                    values: data.map(function (d) {
                        return {name: name, label: d[labelVar_j_2], value: (+d[name])/1000};
                    })
                };
            });
            x_j.domain(data.map(function (d) { return d.year; }));
            y_j.domain([0,0]);
            svg_j_2.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height_j + ")")
                .call(xAxis_j);
            svg_j_2.append("g")
                .attr("class", "y axis")
                .call(yAxis_j)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "0.71em")
                .attr("fill", "#000")
                .text("Number of people (in thousands)");
            var legend_j_2 = svg_j_2.selectAll(".legend")
                .data(color_j.domain())
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function(d, i) { return "translate(0," + i * 13.5 + ")"; });
            var series_j_2 = svg_j_2.selectAll(".series")
                .data(seriesData_j_2)
                .enter().append("g")
                .attr("class", "series");
            series_j_2.append("path")
                .attr("class", "line")
                .attr("d", function (d) { return line_j(d.values); })
                .style("stroke", function (d) { return color_j(d.name); })
                .style("stroke-width", "4px")
                .style("fill", "none")
                .style("opacity", 0)
                .on("mouseover", function(d) {
                    if(d3.select(this).style('opacity') == 1) {
                        tooltip_j.transition()
                            .duration(100)
                            .style("opacity", 0.9);
                        tooltip_j.html(d.name/* + " ("  + data.year + ")<br/>"  + data.value + " people"*/)
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 28) + "px");
                    }
                });
            var	maximum_j_2 = 0;
            legend_j_2.append("circle")
                .style("fill", function(d) { return color_j(d); })
                .attr("r", 5)
                .attr("transform", function(d, i) {
                    return "translate(" + (width_j -260) + "," + -10 + ")";
                })
                .on("mouseover", function(d) {
                    d3.select(this).attr("r", 10);
                })
                .on("mouseout", function(d) {
                    d3.select(this).attr("r", 5);
                })
                .on("click", function(d) {
                    d3.selectAll(".line")
                        .filter(function(e) {
                            return e.name == d;
                        })
                        .style("opacity", function() {
                            if(d3.select(this).style('opacity') == 1) {
                                d3.selectAll('text[d="'+d+'"]')
                                    .style("font-weight", "")
                                    .style("fill", "grey");
                                return 0;
                            }
                            else {
                                d3.selectAll('text[d="'+d+'"]')
                                    .style("font-weight", "bold")
                                    .style("fill", "black");
                                return 1;
                            }
                        });
                    var maximum_j_2 = d3.max(seriesData_j_2, function(e) {
                        return d3.max(e.values, function (c) {
                            if ((d3.selectAll(".line")
                                    .filter(function(f) {
                                        return c.name == f.name;
                                    })
                                    .style('opacity')) == 1) { return c.value; }
                            else { return 0; }
                        });
                    });
                    y_j.domain([0, maximum_j_2]);
                    svg_j_2.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(yAxis_j);
                    svg_j_2.selectAll(".line")
                        .transition()
                        .duration(1000)
                        .attr("d", function(d) { return line_j(d.values); });
                    tooltip_j.transition().style("opacity", 0);
                })
            legend_j_2.append("text")
                .attr("x", width_j-250)
                .attr("y", -10)
                .attr("dy", ".25em")
                .attr("d", function(d) { return d; })
                .style("text-anchor", "start")
                .style("font-weight", "")
                .style("fill", "grey")
                .text(function(d) { return d; })
            svg_j_2.append("circle")
                .style("fill", "black")
                .attr("cx", width_j-110)
                .attr("cy", -10)
                .attr("r", 5)
                .on("mouseover", function(d) {
                    d3.select(this).attr("r", 10);
                })
                .on("mouseout", function(d) {
                    d3.select(this).attr("r", 5);
                })
                .on("click", function(d) {
                    d3.selectAll(".line").style("opacity", 1);
                    maximum_j = d3.max(seriesData_j_2, function (c) {
                        return d3.max(c.values, function (d) { return d.value; });
                    })
                    y_j.domain([
                        d3.min(seriesData_j_2, function (c) {
                            return d3.min(c.values, function (d) { return d.value; });
                        }), maximum_j ]);
                    svg_j_2.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(yAxis_j);
                    svg_j_2.selectAll(".line")
                        .transition()
                        .duration(1000)
                        .attr("d", function (d) { return line_j(d.values); });
                    tooltip_j.transition().style("opacity", 0);
                    legend_j_2.selectAll("text")
                        .style("font-weight", "bold")
                        .style("fill", "black");
                });
            svg_j_2.append("text")
                .attr("x", width_j-100)
                .attr("y", -10)
                .attr("dy", ".25em")
                .style("text-anchor", "start")
                .text("Show all countries");
            svg_j_2.append("circle")
                .style("fill", "white")
                .attr("cx", width_j-110)
                .attr("cy", 10)
                .attr("r", 5)
                .style("stroke", "black")
                .style("stroke-width", "1px")
                .on("mouseover", function(d) {
                    d3.select(this).attr("r", 10);
                })
                .on("mouseout", function(d) {
                    d3.select(this).attr("r", 5);
                })
                .on("click", function(d) {
                    d3.selectAll(".line").style("opacity", 0);
                    maximum_j = 0;
                    y_j.domain([0, 0]);
                    svg_j_2.select(".y.axis")
                        .transition()
                        .duration(1000)
                        .call(yAxis_j);
                    svg_j_2.selectAll(".line")
                        .transition()
                        .duration(1000)
                        .attr("d", function (d) { return line_j(d.values); });
                    tooltip_j.transition().style("opacity", 0);
                    legend_j_2.selectAll("text")
                        .style("font-weight", "")
                        .style("fill", "grey");
                });
            svg_j_2.append("text")
                .attr("x", width_j-100)
                .attr("y", 10)
                .attr("dy", ".25em")
                .style("text-anchor", "start")
                .text("Hide all countries");
        });
    }
    function changeView(){
        if(showArriv == "1") {
            d3.select("#buttonChange").attr("value", "Change to Arrivals");
            tooltip_j.style("opacity", 0);
			d3.select('#ArrDep1').style("visibility", "hidden");
			d3.select('#ArrDep2').style("visibility", "visible");
            GraphTimeDepar();
            showArriv = "0";
        }
        else {
            d3.select("#buttonChange").attr("value", "Change to Departures");
            tooltip_j.style("opacity", 0);
			d3.select('#ArrDep1').style("visibility", "visible");
			d3.select('#ArrDep2').style("visibility", "hidden");
            GraphTimeArriv();
            showArriv = "1";
        }
    }
    function changeGraph(){
        if(showEvolution == "1") {
            d3.select("#buttonGraph").attr("value", "Change to Tourism Evolution");
            tooltip_j.style("opacity", 0);
            d3.select("#svg_j_1").remove();
            d3.select("#svg_j_2").remove();
            document.getElementById("buttonChange").style.visibility = "hidden";
			d3.select('#ArrDep1').style("visibility", "hidden");
			d3.select('#ArrDep2').style("visibility", "hidden");
            d3.select("#year").style("visibility", "visible");
            d3.select("#rangeInput").style("visibility", "visible");
            d3.select("#textInput").style("visibility", "visible");
			textAuthors.style.top = "720px";
			textGithub.style.top = "740px";
            GraphByYear();
            showEvolution = "0";
        }
        else {
            d3.select("#buttonGraph").attr("value", "Change to Tourism by Year");
            d3.select("#chart1").remove();
            d3.select("#chart2").remove();
            d3.select("#pie").remove();
            document.getElementById("buttonChange").style.visibility = "visible";
			d3.select('#ArrDep1').style("visibility", "visible");
            d3.select("#year").style("visibility", "hidden");
            d3.select("#rangeInput").style("visibility", "hidden");
            d3.select("#textInput").style("visibility", "hidden");
            document.getElementById("buttonReturn").style.visibility = "hidden";
			textAuthors.style.top = "660px";
			textGithub.style.top = "680px";
            GraphTimeArriv();
            showEvolution = "1";
        }
    }
</script>

</body>